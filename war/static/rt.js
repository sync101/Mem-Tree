"use strict";var rtclient=rtclient||{};rtclient["INSTALL_SCOPE"]="https://www.googleapis.com/auth/drive.install";rtclient["FILE_SCOPE"]="https://www.googleapis.com/auth/drive.file";rtclient["OPENID_SCOPE"]="openid";rtclient["getOption"]=function (options,key,defaultValue){var value=options[key]==undefined?defaultValue:options[key];if(value==undefined){console["error"](key+" should be present in the options.");} ;return value;} ;rtclient["Authorizer"]=function (type,fileId,options){this["clientId"]=getClientId();this["userId"]="";this["popupHtml"]="\x3Cimg style=\x22border: black 1px solid;\x22 src=\x22http://mem-tree.appspot.com/Icons/popup_blocker.jpg\x22\x3E\x3Cbr\x3E\x3Cbr\x3E\x3Cb\x3EMem-Tree needs Oauth2 token from Google Drive (via popup). \x3Cbr\x3EBrowser might have blocked the popup. \x3C/b\x3E\x3Cbr\x3E\x3Cbr\x3E"+"\x3Cbutton class=\x22gwt-Button\x22 title=\x22Click should invoke the popup. If not, please check if browser blocked the popup as in the above image.\x22 onclick=\x22window.loadRealTimeForFile(\x27"+type+"\x27,\x27"+fileId+"\x27);\x22\x3EAuthorize\x3C/button\x3E"+" \x3Cbutton class=\x22gwt-Button\x22 title=\x22Authorize without popup. Will loose unsaved changes. Make sure to choose the right account which owns the file if logged in multiple accounts. \x22 onclick=\x22window.location.replace(window.getAuthUrl());\x22\x3ENo luck!\x3C/button\x3E"+" \x3Cbutton class=\x22gwt-Button\x22 onclick=\x22window.hideMsgPopup();\x22\x3EIgnore\x3C/button\x3E";this["type"]=type;} ;rtclient["Authorizer"]["prototype"]["start"]=function (onAuthComplete){var _this=this;gapi["load"]("auth:client,drive-realtime,drive-share",function (){_this["authorize"](onAuthComplete);} );} ;rtclient["Authorizer"]["prototype"]["authorize"]=function (onAuthComplete){var clientId=this["clientId"];var userId=this["userId"];var type=this["type"];var _this=this;var hideMsg=false;var handleAuthResult=function (authResult){if(authResult&&!authResult["error"]){onAuthComplete(authResult["access_token"]);if(hideMsg){hideMsgPopup();} ;} else {showMsgPopup(_this["popupHtml"]);hideMsg=true;authorizeWithPopup();} ;} ;var authorizeWithPopup=function (){gapi["auth"]["authorize"]({client_id:clientId,scope:[rtclient["INSTALL_SCOPE"],rtclient["FILE_SCOPE"],rtclient["OPENID_SCOPE"]],user_id:userId,immediate:false},handleAuthResult);} ;gapi["auth"]["authorize"]({client_id:clientId,scope:[rtclient["INSTALL_SCOPE"],rtclient["FILE_SCOPE"],rtclient["OPENID_SCOPE"]],user_id:userId,immediate:true},handleAuthResult);} ;rtclient["Authorizer"]["prototype"]["fetchUserId"]=function (callback){var _this=this;gapi["client"]["load"]("oauth2","v2",function (){gapi["client"]["oauth2"]["userinfo"]["get"]()["execute"](function (resp){if(resp["id"]){_this["userId"]=resp["id"];} ;if(callback){callback();} ;} );} );} ;rtclient["RealtimeLoader"]=function (type,fileId,options){this["onFileLoaded"]=rtclient["getOption"](options,"onFileLoaded");this["initializeModel"]=rtclient["getOption"](options,"initializeModel");this["authorizer"]= new rtclient.Authorizer(type,fileId,options);this["fileId"]=fileId;} ;rtclient["RealtimeLoader"]["prototype"]["start"]=function (afterAuth){var _this=this;this["authorizer"]["start"](function (){if(afterAuth){afterAuth();} ;if(_this["fileId"]!="no-realtime"){_this["load"]();} ;} );} ;rtclient["RealtimeLoader"]["prototype"]["load"]=function (){var authorizer=this["authorizer"];var handleErrors=function (e){if(e["type"]==gapi["drive"]["realtime"]["ErrorType"]["TOKEN_REFRESH_REQUIRED"]){authorizer["authorize"]();} ;} ;if(this["fileId"]){gapi["drive"]["realtime"]["load"](this["fileId"],this["onFileLoaded"],this["initializeModel"],handleErrors);return ;} ;} ;