google["load"]("picker","1");var authToken;function createPicker(){if(authToken){createFilePicker(authToken);} else {gapi["load"]("auth:client,picker",function (){gapi["auth"]["authorize"]({"client_id":getClientId(),"scope":"https://www.googleapis.com/auth/drive.file","immediate":true},handleAuthResult);} );} ;} ;function handleAuthResult(authResult){if(authResult&&!authResult["error"]){var oauthToken=authResult["access_token"];createFilePicker(oauthToken);} ;} ;function createFilePicker(oauthToken){var view= new google["picker"].View(google["picker"]["ViewId"].DOCS)["setQuery"]("*.dma");view["setMimeTypes"]("text/plain");var clientId=getClientId();var picker= new google["picker"].PickerBuilder()["addView"](view)["enableFeature"](google["picker"]["Feature"].NAV_HIDDEN)["setOAuthToken"](oauthToken)["setTitle"]("Choose file")["setAppId"](clientId)["setCallback"](pickerCallback)["build"]();picker["setVisible"](true);} ;function pickerCallback(data){var url="nothing";if(data[google["picker"]["Response"]["ACTION"]]==google["picker"]["Action"]["PICKED"]){var doc=data[google["picker"]["Response"]["DOCUMENTS"]][0];url=doc[google["picker"]["Document"]["URL"]];loadDriveFile(doc["id"]);} else {document["getElementById"]("speech-input-textbox")["focus"]();} ;} ;function installChromeExtension(){if(chrome["app"]["isInstalled"]){showMsg("Already installed");} else {chrome["webstore"]["install"]();} ;} ;function getVideoId(url){var regExp=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;var match=url["match"](regExp);if(match&&match[2]["length"]==11){return "http://youtube.com/embed/"+match[2];} else {return url;} ;} ;function printContent(html){var frame=document["getElementById"]("__printingFrame");if(!frame){alert("Error: Can\x27t find printing frame.");return ;} ;frame=frame["contentWindow"];var doc=frame["document"];var link=doc["createElement"]("link");link["setAttribute"]("rel","stylesheet");link["setAttribute"]("type","text/css");link["setAttribute"]("href","/static/lib/codemirror.css");doc["open"]();doc["write"]("\x3C!DOCTYPE html\x3E\x3Chtml\x3E\x3Chead\x3E\x3Cmeta charset=\x22utf-8\x22/\x3E\x3Cmeta http-quiv=\x22Content-Type\x22 content=\x22text/html; charset=utf-8\x22/\x3E\x3Ctitle\x3EPrint Frame\x3C/title\x3E\x3Clink rel=\x22stylesheet\x22 type=\x22text/css\x22 href=\x22/static/theme/eclipseDMA.css\x22/\x3E\x3C/head\x3E\x3Cbody\x3E"+html+"\x3C/body\x3E\x3C/html\x3E");doc["close"]();frame["focus"]();frame["print"]();} ;var editor= new Array();var hlLine= new Array();function setEditorSize(elementId,width,height){editor[elementId]["setSize"](width,height);} ;function copyEditor(elementId){editor[elementId]["save"]();} ;function changeEditorMode(elementId,mode){editor[elementId]["setOption"]("mode",mode);} ;function createEditor(elementId,mode,width,height){editor[elementId]=CodeMirror["fromTextArea"](document["getElementById"]("codeTab"+elementId),{lineNumbers:true,styleActiveLine:true,matchBrackets:true,highlightSelectionMatches:{showToken:/\w/},indentUnit:4});changeEditorMode(elementId,mode);editor[elementId]["setSize"](width,height);editor[elementId]["focus"]();editor[elementId]["setOption"]("theme","eclipse");} ;function addCollaboratorEvent(evt){var user=evt["collaborator"];addCollaborator(user["photoUrl"],user["userId"],user["displayName"],user["color"],user["sessionId"]);showMsg(user["displayName"]+" opened this file");} ;function removeCollaboratorEvent(evt){var user=evt["collaborator"];removeCollaborator(user["photoUrl"],user["userId"],user["displayName"],user["color"],user["sessionId"]);showMsg(user["displayName"]+" closed this file");} ;function getAllCollaborators(doc){clearCollaborators();var collaborators=doc["getCollaborators"]();var collaboratorCount=collaborators["length"];for(var i=0;i<collaboratorCount;i++){var user=collaborators[i];addCollaborator(user["photoUrl"],user["userId"],user["displayName"],user["color"],user["sessionId"]);} ;} ;function initializeModel(model){} ;var share;var onAuthComplete=function (AuthToken){authToken=AuthToken;if(action_type=="insert"){insertFileAfterAuth();} else {if(action_type=="update"){saveFileAfterAuth();} else {if(action_type=="newuser"){document["getElementById"]("Loading-Message")["innerHTML"]="";} else {getFileMetadata(downloadFile);if(share){return ;} else {var clientId=getClientId();share= new gapi["drive"]["share"].ShareClient(clientId);} ;} ;} ;} ;} ;function shareFile(fileId){if(share){share["setItemIds"]([fileId]);share["showSettingsDialog"]();} ;} ;function onFileLoaded(doc){getAllCollaborators(doc);doc["addEventListener"](gapi["drive"]["realtime"]["EventType"].COLLABORATOR_JOINED,addCollaboratorEvent);doc["addEventListener"](gapi["drive"]["realtime"]["EventType"].COLLABORATOR_LEFT,removeCollaboratorEvent);} ;var realtimeOptions={initializeModel:initializeModel,onFileLoaded:onFileLoaded};var currFileId;var action_type;function loadRealTimeForFile(type,fileId){currFileId=fileId;action_type=type;if(type=="get"){var realtimeLoader= new rtclient.RealtimeLoader(type,fileId,realtimeOptions);realtimeLoader["start"](onAuthComplete);} else {var realtimeLoader= new rtclient.RealtimeLoader(type,"no-realtime",realtimeOptions);realtimeLoader["start"](onAuthComplete);} ;} ;function searchDrive(str,query,afterSearch){var retrievePageOfFiles=function (request,result){request["execute"](function (resp){result=result["concat"](resp["items"]);afterSearch(str,query,result);} );} ;gapi["client"]["load"]("drive","v2",function (){var request=gapi["client"]["drive"]["files"]["list"]({"q":query,"maxResults":20});retrievePageOfFiles(request,[]);} );} ;getFileMetadata=function (callback){if(currFileId){gapi["client"]["load"]("drive","v2",function (){gapi["client"]["drive"]["files"]["get"]({"fileId":currFileId})["execute"](callback);} );} ;} ;var currFile;function downloadFile(file){if(file["downloadUrl"]){currFile=file;var accessToken=gapi["auth"]["getToken"]()["access_token"];var xhr= new XMLHttpRequest();xhr["open"]("GET",file["downloadUrl"]);xhr["setRequestHeader"]("Authorization","Bearer "+accessToken);xhr["onload"]=function (){loadDriveFileContent("/*"+xhr["responseText"]+"*/",file["title"],file["mimeType"]);} ;xhr["onerror"]=function (e){if(e["error"]){hideMsgPopup();showMsg(e["error"]);} else {loadDriveFileContent(null);} ;} ;xhr["send"]();} else {if(file["error"]["message"]){hideMsgPopup();showMsg(file["error"]["message"]);} else {loadDriveFileContent(null);} ;} ;} ;function downloadFileWithUrl(downloadUrl,title){var xhr= new XMLHttpRequest();xhr["open"]("GET",downloadUrl);xhr["onload"]=function (){loadDriveFileContent("/*"+xhr["responseText"]+"*/",title,"text/plain");} ;xhr["onerror"]=function (e){if(e["error"]){hideMsgPopup();showMsg(e["error"]);} else {loadDriveFileContent(null);} ;} ;xhr["send"]();} ;function updateFile(fileData,callback){var boundary="-------314159265358979323846";var delimiter="\x0D\x0A--"+boundary+"\x0D\x0A";var close_delim="\x0D\x0A--"+boundary+"--";if(currFile["mimeType"]){var multipartRequestBody=delimiter+"Content-Type: application/json\x0D\x0A\x0D\x0A"+JSON["stringify"](currFile)+delimiter+"Content-Type: "+currFile["mimeType"]+"\x0D\x0A"+"\x0D\x0A"+fileData+close_delim;var accessToken=gapi["auth"]["getToken"]()["access_token"];var request=gapi["client"]["request"]({"path":"/upload/drive/v2/files/"+currFileId,"method":"PUT","params":{"uploadType":"multipart"},"headers":{"Content-Type":"multipart/mixed; boundary=\x22"+boundary+"\x22","Authorization":"Bearer "+accessToken},"body":multipartRequestBody});if(!callback){callback=function (file){if(!file["error"]){showMsg("Saved");saveComplete();} else {showMsg(file["error"]["message"]);} ;} ;} ;request["execute"](callback);} ;} ;function insertFile(title,fileData,callback){var boundary="-------314159265358979323846";var delimiter="\x0D\x0A--"+boundary+"\x0D\x0A";var close_delim="\x0D\x0A--"+boundary+"--";var contentType="text/plain";var metadata={"title":title,"mimeType":contentType};var multipartRequestBody=delimiter+"Content-Type: application/json\x0D\x0A\x0D\x0A"+JSON["stringify"](metadata)+delimiter+"Content-Type: "+contentType+"\x0D\x0A"+"\x0D\x0A"+fileData+close_delim;var accessToken=gapi["auth"]["getToken"]()["access_token"];var request=gapi["client"]["request"]({"path":"/upload/drive/v2/files","method":"POST","params":{"uploadType":"multipart"},"headers":{"Content-Type":"multipart/mixed; boundary=\x22"+boundary+"\x22","Authorization":"Bearer "+accessToken},"body":multipartRequestBody});if(!callback){callback=function (file){if(!file["error"]){showMsg("Saved");insertComplete(file["id"]);} else {showMsg(file["error"]["message"]);} ;} ;} ;request["execute"](callback);} ;function isMobile(){var check=false;(function (a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i["test"](a)){check=true;} ;} )(navigator["userAgent"]||navigator["vendor"]||window["opera"]);return check;} ;